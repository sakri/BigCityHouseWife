(function(b){var a=function(f,e,d,c){this.topLeft=new BCHWGeom.Point();this.topRight=new BCHWGeom.Point();this.bottomRight=new BCHWGeom.Point();this.bottomLeft=new BCHWGeom.Point();if(f){this.updatePoints(f,e,d,c)}this.triangleA=new BCHWGeom.Triangle(this.topLeft,this.topRight,this.bottomLeft);this.triangleB=new BCHWGeom.Triangle(this.bottomRight,this.bottomLeft,this.topRight);this.transform=new BCHWGeom.Transform();this.imageTriangle=new BCHWGeom.Triangle()};a.prototype.updatePoints=function(f,e,d,c){this.topLeft.x=f.x;this.topLeft.y=f.y;this.topRight.x=e.x;this.topRight.y=e.y;this.bottomRight.x=d.x;this.bottomRight.y=d.y;this.bottomLeft.x=c.x;this.bottomLeft.y=c.y};a.prototype.updatePointsToTransformRectangle=function(c){this.updatePoints(c.topLeft,c.topRight,c.bottomRight,c.bottomLeft)};a.prototype.clone=function(){return new a(new BCHWGeom.Point(this.topLeft.x,this.topLeft.y),new BCHWGeom.Point(this.topRight.x,this.topRight.y),new BCHWGeom.Point(this.bottomRight.x,this.bottomRight.y),new BCHWGeom.Point(this.bottomLeft.x,this.bottomLeft.y))};a.prototype.render=function(c,d){if(d){this.renderImage(c,d)}};a.prototype.renderImage=function(c,d){BCHWGeom.setIdentityMatrixToContext(c);c.fillStyle=c.createPattern(d,"no-repeat");this.imageTriangle.a.x=this.imageTriangle.a.y=this.imageTriangle.b.y=this.imageTriangle.c.x=0;this.imageTriangle.b.x=d.width;this.imageTriangle.c.y=d.height;this.updateTriangleTransform(this.imageTriangle,this.triangleA);this.transform.tx=this.triangleA.a.x;this.transform.ty=this.triangleA.a.y;c.setTransform(this.transform.scaleX,this.transform.skewX,this.transform.skewY,this.transform.scaleY,this.transform.tx,this.transform.ty);c.beginPath();c.moveTo(0,0);c.lineTo(d.width,0);c.lineTo(0,d.height);c.moveTo(0,0);c.fill();c.closePath();BCHWGeom.setIdentityMatrixToContext(c);this.imageTriangle.b.x=this.imageTriangle.c.y=0;this.imageTriangle.a.x=this.imageTriangle.c.x=d.width;this.imageTriangle.a.y=d.height;this.imageTriangle.b.y=d.height;this.updateTriangleTransform(this.imageTriangle,this.triangleB);this.transform.ty=this.triangleA.a.y+(this.triangleA.b.y-this.triangleA.a.y)*2;c.setTransform(this.transform.scaleX,this.transform.skewX,this.transform.skewY,this.transform.scaleY,this.transform.tx,this.transform.ty);c.beginPath();c.moveTo(d.width,d.height);c.lineTo(0,d.height);c.lineTo(0,d.height-1);c.lineTo(d.width-1,0);c.lineTo(d.width,0);c.lineTo(d.width,d.height);c.fill();c.closePath();BCHWGeom.setIdentityMatrixToContext(c)};a.prototype.updateTriangleTransform=function(c,j){var h=BCHWGeom.angleBetweenTwoPoints(j.b,j.a);var e=BCHWGeom.angleBetweenTwoPoints(j.c,j.a);var g=BCHWGeom.distanceBetweenTwoPoints(j.a,j.b);var i=BCHWGeom.distanceBetweenTwoPoints(j.a,j.c);var f=g/(c.b.x-c.a.x);var d=i/(c.c.y-c.a.y);this.transform.scaleX=Math.cos(h)*f;this.transform.scaleY=Math.sin(e)*d;this.transform.skewX=Math.sin(h)*f;this.transform.skewY=Math.cos(e)*d};a.prototype.renderOutline=function(c){c.strokeStyle="#FF0000";c.lineWidth=1;c.beginPath();c.moveTo(this.triangleA.a.x,this.triangleA.a.y);c.lineTo(this.triangleA.b.x,this.triangleA.b.y);c.lineTo(this.triangleA.c.x,this.triangleA.c.y);c.lineTo(this.triangleA.a.x,this.triangleA.a.y);c.stroke();c.closePath();c.beginPath();c.moveTo(this.triangleB.a.x,this.triangleB.a.y);c.lineTo(this.triangleB.b.x,this.triangleB.b.y);c.lineTo(this.triangleB.c.x,this.triangleB.c.y);c.lineTo(this.triangleB.a.x,this.triangleB.a.y);c.stroke();c.closePath()};b.TransformRectangle=a}(window));