(function(a){var b=function(d,c){LayoutRectangle.call(this,d);this.bubbleArrowHeight=c;this.lineThickness=4;this.animateTimeoutId=-1;this.padding=10};b.prototype=Object.create(LayoutRectangle.prototype);b.prototype.constructor=LayoutRectangle;b.ANIMATE_INTERVAL=20;b.prototype.render=function(h,c,f,j){this.triangleX=c;this.completeCallback=j?j:null;this.clear();this.x=h.x-this.padding;this.y=h.y-this.padding;this.width=h.width+this.padding*2;this.height=h.height+this.padding*2;var g=18;var d=9;this.cornerRadii=[];for(var e=0;e<4;e++){this.cornerRadii[e]=BCHWMathUtil.getRandomNumberInRange(d,g)}this.animationPercent=0.4;this.nextAnimationStep()};b.prototype.renderBubble=function(e){this.clear();this.context.fillStyle="#FFFFFF";this.context.lineWidth=0;var d=new BCHWGeom.Rectangle(this.x+1,this.y+1,(this.width-2)*e,this.height-this.bubbleArrowHeight-2);this.context.beginPath();var c=this.cornerRadii[0];this.context.moveTo(d.x,d.y+c);this.context.arc(d.x+c,d.y+c,c,Math.PI,Math.PI+BCHWMathUtil.HALF_PI);c=this.cornerRadii[1];this.context.lineTo(d.getRight()-c,d.y);this.context.arc(d.getRight()-c,d.y+c,c,Math.PI+BCHWMathUtil.HALF_PI,BCHWMathUtil.PI2);c=this.cornerRadii[2];this.context.lineTo(d.getRight(),d.getBottom()-c);this.context.arc(d.getRight()-c,d.getBottom()-c,c,0,BCHWMathUtil.HALF_PI);c=this.cornerRadii[3];this.context.lineTo(d.x+c,d.getBottom());this.context.arc(d.x+c,d.getBottom()-c,c,BCHWMathUtil.HALF_PI,Math.PI);c=this.cornerRadii[0];this.context.lineTo(d.x,d.y+c);this.context.fill();this.context.closePath();if(e==1){this.context.beginPath();this.context.moveTo(this.triangleX,d.getBottom()-2);this.context.lineTo(this.triangleX,this.getBottom());this.context.lineTo(this.triangleX+this.padding+Math.random()*(2*this.padding),d.getBottom()-2);this.context.closePath();this.context.fill()}};b.prototype.nextAnimationStep=function(){this.animationPercent=BCHWMathUtil.clamp(0,1,(this.animationPercent+0.05));this.renderBubble(this.animationPercent);var c=this;if(this.animationPercent<1){this.animateTimeoutId=setTimeout(function(){c.nextAnimationStep()},b.ANIMATE_INTERVAL)}else{if(this.completeCallback){this.completeCallback();this.completeCallback=null}}};b.prototype.stop=function(){this.clear();clearTimeout(this.animateTimeoutId)};a.BCHWSpeechBubble=b}(window));