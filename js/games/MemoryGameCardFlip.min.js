(function(a){var b=function(d,c){this.flipDuration=isNaN(d)?500:d;this.flipFramerate=isNaN(c)?20:c;this.unitAnimator=new UnitAnimator();this.transformRectangle=new TransformRectangle();this.simpleRect=new BCHWGeom.Rectangle};b.useGradient=false;b.useSimpleFlip=false;b.prototype.flip=function(d,g,c,j,i,f,e){this.flipRect=d;this.context=g;this.image1=c;this.image2=j;this.updateCallback=i;this.completeCallback=f;this.autoClear=e;var h=this;this.unitAnimator.reset(this.flipDuration,this.flipFramerate,function(){h.flipUpdateHandler()},function(){h.flipCompleteHandler()});this.unitAnimator.start()};b.prototype.flipUpdateHandler=function(){var c=this.unitAnimator.getAnimationPercent();if(this.updateCallback){this.updateCallback()}if(this.autoClear){this.context.clearRect(this.flipRect.x,this.flipRect.y,this.flipRect.width,this.flipRect.height)}switch(c){case 0.5:this.drawHalfwayLine();return;case 0:this.drawImage(this.image1);return;case 1:this.drawImage(this.image2);return}if(b.useSimpleFlip){if(c<0.5){this.updateFlipFirstHalfSimple(c)}else{this.updateFlipSecondHalfSimple(c)}}else{if(c<0.5){this.updateFlipFirstHalf(c)}else{this.updateFlipSecondHalf(c)}}};b.prototype.drawImage=function(c){this.context.drawImage(c,this.flipRect.x,this.flipRect.y,this.flipRect.width,this.flipRect.height)};b.prototype.drawHalfwayLine=function(){this.context.lineWidth=2;this.context.strokeStyle="rgba(0,0,0,.5)";this.context.beginPath();this.context.moveTo(this.flipRect.getCenterX(),this.flipRect.y+this.flipRect.height*0.25);this.context.lineTo(this.flipRect.getCenterX(),this.flipRect.y+this.flipRect.height*0.75);this.context.stroke()};b.prototype.updateFlipFirstHalf=function(c){this.transformRectangle.topLeft.y=this.flipRect.y;this.transformRectangle.bottomLeft.y=this.flipRect.getBottom();this.transformRectangle.topLeft.x=this.transformRectangle.bottomLeft.x=this.flipRect.x+this.flipRect.width*c;this.transformRectangle.topRight.x=this.transformRectangle.bottomRight.x=this.flipRect.getRight()-(this.transformRectangle.topLeft.x-this.flipRect.x);var d=(this.flipRect.height/2)*c;this.transformRectangle.topRight.y=this.flipRect.y+d;this.transformRectangle.bottomRight.y=this.transformRectangle.bottomLeft.y-d;this.transformRectangle.renderImage(this.context,this.image1);if(b.useGradient){this.gradient=this.context.createLinearGradient(this.transformRectangle.topRight.x,this.transformRectangle.topLeft.y,this.transformRectangle.topLeft.x,this.transformRectangle.topLeft.y);this.drawGradient(this.getGradientAlphaForPercent(c))}};b.prototype.updateFlipSecondHalf=function(c){this.transformRectangle.topRight.y=this.flipRect.y;this.transformRectangle.bottomRight.y=this.flipRect.getBottom();this.transformRectangle.topRight.x=this.transformRectangle.bottomRight.x=this.flipRect.x+this.flipRect.width*c;this.transformRectangle.topLeft.x=this.transformRectangle.bottomLeft.x=this.flipRect.x+(this.flipRect.getRight()-this.transformRectangle.topRight.x);var d=(this.flipRect.height/2)*(1-c);this.transformRectangle.topLeft.y=this.flipRect.y+d;this.transformRectangle.bottomLeft.y=this.transformRectangle.bottomRight.y-d;this.transformRectangle.renderImage(this.context,this.image2);if(b.useGradient){this.gradient=this.context.createLinearGradient(this.transformRectangle.topLeft.x,this.transformRectangle.topLeft.y,this.transformRectangle.topRight.x,this.transformRectangle.topLeft.y);this.drawGradient(this.getGradientAlphaForPercent(c))}};b.prototype.updateFlipFirstHalfSimple=function(d){var c=this.flipRect.width*d;this.simpleRect.update(this.flipRect.x+c,this.flipRect.y,this.flipRect.width-c*2,this.flipRect.height);this.context.drawImage(this.image1,this.simpleRect.x,this.simpleRect.y,this.simpleRect.width,this.simpleRect.height);if(b.useGradient){this.gradient=this.context.createLinearGradient(this.simpleRect.getRight(),this.simpleRect.y,this.simpleRect.x,this.simpleRect.y);this.drawGradientSimple(this.getGradientAlphaForPercent(d))}};b.prototype.updateFlipSecondHalfSimple=function(d){var c=this.flipRect.width-this.flipRect.width*d;this.simpleRect.update(this.flipRect.x+c,this.flipRect.y,this.flipRect.width-c*2,this.flipRect.height);this.context.drawImage(this.image2,this.simpleRect.x,this.simpleRect.y,this.simpleRect.width,this.simpleRect.height);if(b.useGradient){this.gradient=this.context.createLinearGradient(this.simpleRect.x,this.simpleRect.y,this.simpleRect.getRight(),this.simpleRect.y);this.drawGradientSimple(this.getGradientAlphaForPercent(d))}};b.prototype.getGradientAlphaForPercent=function(c){return 0.5-Math.abs(0.5-c)};b.prototype.drawGradient=function(c){if(c<0.1){return}this.gradient.addColorStop(0,"rgba(0,0,0,"+c+")");this.gradient.addColorStop(1,"rgba(0,0,0,0)");this.context.fillStyle=this.gradient;this.context.beginPath();this.context.moveTo(this.transformRectangle.topLeft.x,this.transformRectangle.topLeft.y);this.context.lineTo(this.transformRectangle.topRight.x,this.transformRectangle.topRight.y);this.context.lineTo(this.transformRectangle.bottomRight.x,this.transformRectangle.bottomRight.y);this.context.lineTo(this.transformRectangle.bottomLeft.x,this.transformRectangle.bottomLeft.y);this.context.closePath();this.context.fill()};b.prototype.drawGradientSimple=function(c){if(c<0.1){return}this.gradient.addColorStop(0,"rgba(0,0,0,"+c+")");this.gradient.addColorStop(1,"rgba(0,0,0,0)");this.context.fillStyle=this.gradient;this.context.closePath();this.context.fillRect(this.simpleRect.x,this.simpleRect.y,this.simpleRect.width,this.simpleRect.height)};b.prototype.flipCompleteHandler=function(){if(this.completeCallback){this.completeCallback()}};b.prototype.stop=function(){this.unitAnimator.pause();this.updateCallback=undefined;this.completeCallback=undefined};a.MemoryGameCardFlip=b}(window));