(function(a){function b(){this.margin=0.05;this.momWidth=0.2;this.lineThickness=4;this.resizeTimeoutId=-1;this.bubbleArrowHeight=20}b.REFRESH_AFTER_RESIZE_INTERVAL=300;b.TWEET_INTERVAL=5000;b.prototype.init=function(e,c){this.canvas=document.createElement("canvas");this.canvasContainer=e;this.context=this.canvas.getContext("2d");this.context.lineCap="round";this.canvasContainer.appendChild(this.canvas);this.logo=new BCHWLogo(this.canvas);this.logo.lineThickness=this.lineThickness;this.mom=new BCHWMom(this.canvas);this.mom.lineThickness=this.lineThickness;this.render();this.tweetsManager=new TweetsManager();var d=this;this.tweetsManager.loadTweets(function(){d.tweetsLoadedHandler()});this.speechBubbleContainer=c;this.speechBubble=new BCHWSpeechBubble(this.canvas,this.bubbleArrowHeight)};b.prototype.clearContext=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};b.prototype.resizeHandler=function(){this.clearContext();this.speechBubbleContainer.style.opacity=0;clearTimeout(this.resizeTimeoutId);clearTimeout(this.twitterTalkTimeout);this.speechBubble.stop();var c=this;this.resizeTimeoutId=setTimeout(function(){c.reset()},b.REFRESH_AFTER_RESIZE_INTERVAL)};b.prototype.reset=function(){this.render();this.setTwitterTalkTimeout()};b.prototype.render=function(){this.canvas.width=this.canvasContainer.clientWidth;this.canvas.height=this.canvasContainer.clientHeight;this.clearContext();var e=this.canvas.width*this.margin;var d=this.canvas.height*this.margin;var c=new BCHWGeom.Rectangle(e,d,this.canvas.width-e*2,this.canvas.height-d*2);this.lineThickness=c.width>700?4:2;this.momBounds=new BCHWGeom.Rectangle(c.x,c.y,c.width*this.momWidth,c.height);this.mom.render(this.momBounds,this.lineThickness);this.logoBounds=new BCHWGeom.Rectangle(this.momBounds.getRight()+this.lineThickness,c.y,c.getRight()-this.momBounds.getRight()-this.lineThickness,c.height);this.logo.render(this.logoBounds,this.lineThickness)};b.prototype.tweetsLoadedHandler=function(){this.showNextTweet()};b.prototype.showNextTweet=function(){this.speechBubbleContainer.style.opacity=0;var e=this.tweetsManager.getNextTweet();this.speechBubbleContainer.innerHTML="<p>"+e+"</p>";this.speechBubbleContainer.style.maxWidth=(this.logoBounds.width+this.momBounds.width/2)+"px";var c=this.canvasContainer.offsetLeft+this.mom.getCenterX();var f=this.canvasContainer.offsetTop+this.mom.y-this.speechBubbleContainer.clientHeight-this.bubbleArrowHeight-this.speechBubble.padding*2;this.speechBubbleContainer.style.left=c+"px";this.speechBubbleContainer.style.top=f+"px";this.bubbleBounds=new BCHWGeom.Rectangle(this.mom.getCenterX(),this.mom.y-this.speechBubbleContainer.clientHeight-this.bubbleArrowHeight-this.speechBubble.padding*2,this.speechBubbleContainer.clientWidth,this.speechBubbleContainer.clientHeight+this.bubbleArrowHeight);this.mom.render(this.momBounds,this.lineThickness);var d=this;this.speechBubble.render(this.bubbleBounds,this.lineThickness,function(){d.speechBubbleCompleteHandler()})};b.prototype.speechBubbleCompleteHandler=function(){this.speechBubbleContainer.style.opacity=1;this.setTwitterTalkTimeout()};b.prototype.setTwitterTalkTimeout=function(){var c=this;this.twitterTalkTimeout=setTimeout(function(){c.showNextTweet()},b.TWEET_INTERVAL)};b.prototype.speechBubbleContainerMouseOverHandler=function(){clearTimeout(this.twitterTalkTimeout)};b.prototype.speechBubbleContainerMouseOutHandler=function(d){var c=new BCHWGeom.Rectangle(this.speechBubbleContainer.offsetLeft,this.speechBubbleContainer.offsetTop,this.speechBubbleContainer.clientWidth,this.speechBubbleContainer.clientHeight);if(!c.containsPoint(d.clientX,d.clientY)){this.setTwitterTalkTimeout()}};a.BCHWMain=b}(window));