(function(a){function b(){this.margin=0.05;this.momProportions=new BCHWGeom.Rectangle(0,0,200,250);this.lineThickness=4;this.resizeTimeoutId=-1;this.bubbleArrowHeight=20}b.REFRESH_AFTER_RESIZE_INTERVAL=300;b.TWEET_INTERVAL=5000;b.MOUSEOVER_TWEET_INTERVAL=8000;b.prototype.init=function(e,c){this.canvas=document.createElement("canvas");this.canvasContainer=e;this.context=this.canvas.getContext("2d");this.context.lineCap="round";this.canvasContainer.appendChild(this.canvas);this.logo=new BCHWLogo(this.canvas);this.mom=new BCHWMom(this.canvas);this.girl=new BCHWGirl(this.canvas);this.boy=new BCHWBoy(this.canvas);this.dad=new BCHWDad(this.canvas);this.render();this.tweetsManager=new TweetsManager();var d=this;this.tweetsManager.loadTweets(function(){d.tweetsLoadedHandler()});this.speechBubbleContainer=c;this.speechBubble=new BCHWSpeechBubble(this.canvas,this.bubbleArrowHeight)};b.prototype.clearContext=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};b.prototype.resizeHandler=function(){this.clearContext();this.speechBubbleContainer.style.opacity=0;clearTimeout(this.resizeTimeoutId);clearTimeout(this.twitterTalkTimeout);this.speechBubble.stop();var c=this;this.resizeTimeoutId=setTimeout(function(){c.reset()},b.REFRESH_AFTER_RESIZE_INTERVAL)};b.prototype.reset=function(){this.render();this.setTwitterTalkTimeout()};b.prototype.render=function(){this.canvas.width=this.canvasContainer.clientWidth;this.canvas.height=this.canvasContainer.clientHeight;this.clearContext();var h,g;if(this.canvasContainer.clientWidth>800){this.lineThickness=4;h=4;g=4}else{this.lineThickness=2;h=this.canvas.width*this.margin;g=this.canvas.height*this.margin}var i=new BCHWGeom.Rectangle(h,g,this.canvas.width-h*2,this.canvas.height-g*2);var f=new BCHWGeom.Rectangle(0,0,800,200);BCHWGeom.RectangleUtil.scaleRectInto(i,f);BCHWGeom.RectangleUtil.verticalAlignMiddle(i,f);this.logoBounds=this.logo.getContentRect(f);this.logoBounds.height*=2;var d=this.logoBounds.height+this.logoBounds.height/8;var e=d/this.momProportions.height;this.momBounds=new BCHWGeom.Rectangle(f.x,f.y,this.momProportions.width*e,d);var j=new BCHWGeom.Rectangle(0,0,this.logoBounds.width+this.momBounds.width*2,d);BCHWGeom.RectangleUtil.scaleRectInto(f,j);e=j.height/this.momProportions.height;this.momBounds.height=j.height;this.momBounds.width=this.momProportions.width*e;this.mom.render(this.momBounds,this.lineThickness);this.dadBounds=new BCHWGeom.Rectangle(f.getRight()-this.mom.width,this.mom.y,this.mom.width,this.mom.height);this.dad.render(this.dadBounds,this.lineThickness);this.logoBounds.width=j.width-this.mom.width*2-this.mom.width/4;this.logoBounds.height=j.height;this.logoBounds.x=this.mom.getRight()+this.mom.width/8;this.logoBounds.y=this.mom.getBottom()-j.height;this.logo.render(this.logoBounds,this.lineThickness);var c=this.logo.getCharacterBounds(2,0);this.girlBounds=c.clone();this.girlBounds.width*=0.9;this.girlBounds.height*=0.8;BCHWGeom.RectangleUtil.horizontalAlignMiddle(c,this.girlBounds);BCHWGeom.RectangleUtil.verticalAlignBottom(c,this.girlBounds);this.girlBounds.y-=(c.height+this.lineThickness);this.girl.render(this.girlBounds,this.lineThickness);c=this.logo.getCharacterBounds(2,1);this.boyBounds=c.clone();this.boyBounds.width*=0.9;this.boyBounds.height*=1.1;BCHWGeom.RectangleUtil.verticalAlignBottom(c,this.boyBounds);this.boyBounds.y-=(c.height+this.lineThickness);this.boy.render(this.boyBounds,this.lineThickness)};b.prototype.tweetsLoadedHandler=function(){this.showNextTweet()};b.prototype.showNextTweet=function(){this.speechBubbleContainer.style.opacity=0;var e=this.tweetsManager.getNextTweet();this.speechBubbleContainer.innerHTML="<p>"+e+"</p>";this.speechBubbleContainer.style.maxWidth=(this.logoBounds.width+this.momBounds.width/2)+"px";var c=this.canvasContainer.offsetLeft+this.mom.getCenterX();var f=this.canvasContainer.offsetTop+this.mom.y-this.speechBubbleContainer.clientHeight-this.bubbleArrowHeight-this.speechBubble.padding*2;this.speechBubbleContainer.style.left=c+"px";this.speechBubbleContainer.style.top=f+"px";this.bubbleBounds=new BCHWGeom.Rectangle(this.mom.getCenterX(),this.mom.y-this.speechBubbleContainer.clientHeight-this.bubbleArrowHeight-this.speechBubble.padding*2,this.speechBubbleContainer.clientWidth,this.speechBubbleContainer.clientHeight+this.bubbleArrowHeight);this.mom.render(this.momBounds,this.lineThickness);var d=this;this.speechBubble.render(this.bubbleBounds,this.lineThickness,function(){d.speechBubbleCompleteHandler()});this.girl.render(this.girlBounds,this.lineThickness);this.boy.render(this.boyBounds,this.lineThickness);this.dad.render(this.dadBounds,this.lineThickness)};b.prototype.speechBubbleCompleteHandler=function(){this.speechBubbleContainer.style.opacity=1;this.setTwitterTalkTimeout()};b.prototype.setTwitterTalkTimeout=function(c){var d=this;this.twitterTalkTimeout=setTimeout(function(){d.showNextTweet()},isNaN(c)?b.TWEET_INTERVAL:c)};b.prototype.speechBubbleContainerMouseOverHandler=function(){clearTimeout(this.twitterTalkTimeout);this.setTwitterTalkTimeout(b.MOUSEOVER_TWEET_INTERVAL)};a.BCHWMain=b}(window));